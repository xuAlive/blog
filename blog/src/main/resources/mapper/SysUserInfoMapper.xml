<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xu.blog.mapper.SysUserInfoMapper">

    <resultMap id="BaseResultMap" type="com.xu.blog.domain.SysUserInfo">
            <id property="id" column="id" jdbcType="INTEGER"/>
            <result property="account" column="account" jdbcType="VARCHAR"/>
            <result property="phone" column="phone" jdbcType="VARCHAR"/>
            <result property="name" column="name" jdbcType="VARCHAR"/>
            <result property="userName" column="user_name" jdbcType="VARCHAR"/>
            <result property="birthday" column="birthday" jdbcType="DATE"/>
            <result property="age" column="age" jdbcType="INTEGER"/>
            <result property="sex" column="sex" jdbcType="INTEGER"/>
            <result property="email" column="email" jdbcType="VARCHAR"/>
            <result property="idCard" column="id_card" jdbcType="VARCHAR"/>
            <result property="intro" column="intro" jdbcType="VARCHAR"/>
            <result property="isDelete" column="is_delete" jdbcType="INTEGER"/>
            <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>
            <result property="updateTime" column="update_time" jdbcType="TIMESTAMP"/>
    </resultMap>

    <sql id="Base_Column_List">
        id,account,phone,
        name,user_name,birthday,
        age,sex,email,
        id_card,intro,is_delete,
        create_time,update_time
    </sql>

    <select id="selectByAccount" resultType="com.xu.blog.param.vo.sys.UserInfoVo">
        select account,
               phone,
               name,
               user_name,
               birthday,
               age,
               sex,
               email,
               id_card,
               intro
        from sys_user_info
        where account= #{account};
    </select>

    <update id="delteUserInfo">
        update sys_user_info set is_delete = 1 where account = #{account}
    </update>

    <select id="selectUserList" resultType="com.xu.blog.param.vo.sys.UserListVO">
        SELECT
            u.account,
            ui.user_name AS userName,
            ui.name,
            ui.email,
            ui.phone,
            u.is_delete AS isDelete,
            u.create_time AS createTime,
            u.update_time AS updateTime
        FROM sys_user u
        LEFT JOIN sys_user_info ui ON u.account = ui.account
        WHERE u.is_delete = 0
        ORDER BY u.create_time DESC
    </select>

    <insert id="insertOrUpdateUserInfo" parameterType="com.xu.blog.domain.SysUserInfo">
        INSERT INTO sys_user_info (
            account,
            phone,
            name,
            user_name,
            birthday,
            age,
            sex,
            email,
            id_card,
            intro,
            create_time,
            update_time
        ) VALUES (
            #{account},
            #{phone},
            #{name},
            #{userName},
            #{birthday},
            #{age},
            #{sex},
            #{email},
            #{idCard},
            #{intro},
            NOW(),
            NOW()
        )
        ON DUPLICATE KEY UPDATE
            phone = VALUES(phone),
            name = VALUES(name),
            user_name = VALUES(user_name),
            birthday = VALUES(birthday),
            age = VALUES(age),
            sex = VALUES(sex),
            email = VALUES(email),
            id_card = VALUES(id_card),
            intro = VALUES(intro),
            update_time = NOW()
    </insert>
</mapper>
